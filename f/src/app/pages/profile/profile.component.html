<div class="profile-container">
    <!-- Cargando -->
    <div *ngIf="loading" class="loading">
        <p>Cargando perfil...</p>
    </div>

    <!-- Perfil del usuario -->
    <div *ngIf="!loading && user" class="profile-content">
        <h2>Mi Perfil</h2>

        <!-- Mensajes -->
        <div *ngIf="message" class="alert alert-success">
            {{ message }}
        </div>

        <div *ngIf="errorMessage" class="alert alert-error">
            {{ errorMessage }}
        </div>

        <!-- Información del usuario -->
        <div class="user-info">
            <p><strong>ID:</strong> {{ user.id }}</p>
            <p>
                <strong>Rol:</strong> {{ user.is_admin ? "Administrador" : "Usuario" }}
            </p>
        </div>

        <!-- Formulario de edición -->
        <form [formGroup]="profileForm" (ngSubmit)="updateProfile()" class="profile-form">
            <div class="form-group">
                <label for="name">Nombre:</label>
                <input type="text" id="name" formControlName="name" class="form-control"
                    [class.error]="pf['name'].invalid && pf['name'].touched" />
                <div *ngIf="pf['name'].invalid && pf['name'].touched" class="error-message">
                    <div *ngIf="pf['name'].errors?.['required']">
                        El nombre es requerido
                    </div>
                    <div *ngIf="pf['name'].errors?.['minlength']">
                        El nombre debe tener al menos 2 caracteres
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" formControlName="email" class="form-control"
                    [class.error]="pf['email'].invalid && pf['email'].touched" />
                <div *ngIf="pf['email'].invalid && pf['email'].touched" class="error-message">
                    <div *ngIf="pf['email'].errors?.['required']">
                        El email es requerido
                    </div>
                    <div *ngIf="pf['email'].errors?.['email']">
                        El formato del email es inválido
                    </div>
                </div>
            </div>

            <!-- Campos de contraseña (solo si se quiere cambiar) -->
            <div class="password-section">
                <h3>Cambiar Contraseña (opcional)</h3>

                <div class="form-group">
                    <label for="current_password">Contraseña Actual:</label>
                    <input type="password" id="current_password" formControlName="current_password"
                        class="form-control" />
                    <small>Requerida solo si cambias la contraseña</small>
                </div>

                <div class="form-group">
                    <label for="password">Nueva Contraseña:</label>
                    <input type="password" id="password" formControlName="password" class="form-control"
                        [class.error]="pf['password'].invalid && pf['password'].touched" />
                    <div *ngIf="pf['password'].invalid && pf['password'].touched" class="error-message">
                        <div *ngIf="pf['password'].errors?.['minlength']">
                            La contraseña debe tener al menos 8 caracteres
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="password_confirmation">Confirmar Nueva Contraseña:</label>
                    <input type="password" id="password_confirmation" formControlName="password_confirmation"
                        class="form-control" />
                </div>

                <div *ngIf="profileForm.errors?.['passwordMismatch'] && pf['password'].touched" class="error-message">
                    Las contraseñas no coinciden
                </div>
            </div>

            <button type="submit" class="btn btn-primary" [disabled]="saving || profileForm.invalid">
                {{ saving ? "Guardando..." : "Actualizar Perfil" }}
            </button>
        </form>

        <!-- Sección peligrosa - Eliminar cuenta -->
        <div class="danger-zone">
            <h3>Zona Peligrosa</h3>

            <div *ngIf="deleteError" class="alert alert-error">
                {{ deleteError }}
            </div>

            <form [formGroup]="deleteForm" (ngSubmit)="deleteAccount()" class="delete-form">
                <div class="form-group">
                    <label for="deletePassword">Contraseña para confirmar eliminación:</label>
                    <input type="password" id="deletePassword" formControlName="password" class="form-control"
                        [class.error]="df['password'].invalid && df['password'].touched" />
                    <div *ngIf="df['password'].invalid && df['password'].touched" class="error-message">
                        La contraseña es requerida para eliminar la cuenta
                    </div>
                </div>

                <button type="submit" class="btn btn-danger" [disabled]="deleting || deleteForm.invalid">
                    {{ deleting ? "Eliminando..." : "Eliminar Mi Cuenta" }}
                </button>
            </form>
        </div>
    </div>
</div>